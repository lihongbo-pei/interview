# 微服务

## Eureka

@EnableEurekaServer：在 Spring Boot 的主启动类中，开启 Eureka 注册中心功能的关键注解

在application.yml中：

```yaml
eureka:
  instance:
    preferIpAddress: true
    ip-address: 127.0.0.1
  client:
    register-with-eureka: false
    fetch-registry: false
```

说明这个服务：

- **不会注册自己到注册中心**（因为它本身就是注册中心）
- **不会从别的注册中心拉取服务列表**

也就是说：这是 **Eureka Server 自己的配置**。

## Spring Cloud Gateway

Netflix Zuul升级到Spring Cloud Gateway

- MVC（Servlet）方式
- WebFlux（响应式）方式

### HTTP 状态码401和403

HTTP 状态码 `401 Unauthorized` 和 `403 Forbidden` 都表示客户端请求被拒绝，但核心区别在于**身份验证状态**和**拒绝原因**：

#### 🔐 401 Unauthorized (未授权)
*   **核心含义：** 请求缺乏有效的身份验证凭证，或提供的凭证无效/过期。
*   **身份状态：** 服务器**无法确认**你是谁（未认证）。
*   **服务器行为：**
    *   通常会返回一个 `WWW-Authenticate` 响应头，指示客户端应如何提供凭证（例如使用 Basic Auth、Bearer Token 等）。
    *   期望客户端在后续请求中提供有效的凭证。
*   **类比：** 尝试进入需要门禁卡的大楼，但你没有刷卡或刷了张无效卡。系统说：“请出示有效门禁卡证明身份”。
*   **常见场景：**
    *   未登录时访问需要登录的页面。
    *   API 请求中缺少 `Authorization` 请求头。
    *   提供的用户名/密码错误。
    *   JWT 令牌过期、签名无效或格式错误。
*   **解决方法：** 提供有效且正确的身份验证凭证（用户名/密码、Token 等）。

#### 🚫 403 Forbidden (禁止访问)
*   **核心含义：** 服务器理解请求且已识别用户身份，但该用户**没有权限**执行此操作或访问此资源。
*   **身份状态：** 服务器**知道**你是谁（已认证）。
*   **服务器行为：**
    *   通常**不会**返回 `WWW-Authenticate` 头（因为身份验证已通过）。
    *   直接拒绝请求，不要求客户端重新提供身份凭证。
*   **类比：** 你已用员工卡进入了大楼（认证成功），但试图打开一个只有经理才有权限进入的办公室门禁。系统说：“我知道你是员工X，但你没有进入这间办公室的权限”。
*   **常见场景：**
    *   普通用户尝试访问管理员后台。
    *   用户A 尝试删除或修改 用户B 拥有的资源（如文件、帖子）。
    *   用户的账户状态受限（如被封禁）。
    *   基于角色的访问控制中，用户角色不具备所需权限。
    *   IP地址被列入黑名单。
*   **解决方法：**
    *   联系系统管理员申请所需权限。
    *   使用拥有足够权限的账户（如果合法且被允许）。
    *   检查账户状态是否正常。
    *   **无法通过重新登录或刷新令牌解决（身份本身没问题，是权限不足）。**

#### 📌 关键区别总结

| 特性           | 401 Unauthorized                   | 403 Forbidden                             |
| :------------- | :--------------------------------- | :---------------------------------------- |
| **核心问题**   | **身份未验证** 或 **凭证无效**     | **身份已验证但权限不足**                  |
| **身份状态**   | 服务器不知道/不信任你是谁          | 服务器知道你是谁                          |
| **凭证**       | 缺少、无效、格式错误、过期         | 有效且已被服务器接受                      |
| **响应头**     | 通常包含 `WWW-Authenticate`        | 通常**不**包含 `WWW-Authenticate`         |
| **客户端行动** | 需要提供/更新有效的身份验证凭证    | 需要获取更高的访问权限或停止尝试该操作    |
| **类比**       | “请证明你是谁” (门禁卡无效/未出示) | “我知道你是谁，但你不能进这里” (权限不足) |

#### ⚠️ 需要注意的点

*   **命名歧义：** `401 Unauthorized` 的名字容易引起误解（字面是“未授权”，实际是“未认证”）。理解其真实含义（认证问题）是关键。
*   **安全考虑：** 有时为了避免泄露资源的存在性，服务器会对无权访问的资源返回 `404 Not Found` 而不是 `403 Forbidden`（尤其是在未认证时）。但这取决于具体的安全策略。
*   **顺序：** 通常，服务器会先检查身份验证（可能导致401），再检查权限（可能导致403）。

**简单来说：遇到 `401` 请检查登录状态和凭证有效性；遇到 `403` 则说明你已登录成功，但当前账户无权进行该操作。**

#### 实现GlobalFilter和继承AbstractGatewayFilterFactory的区别